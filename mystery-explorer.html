<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√ÜKON Mystery Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Red+Hat+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        .font-display { font-family: 'Red Hat Display', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .text-cyan { color: #00ffff; }
        .text-purple { color: #a855f7; }
        .text-green { color: #10b981; }
        .text-yellow { color: #f59e0b; }
        .text-red { color: #ef4444; }
        
        body {
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            color: #e4e4e7;
            font-family: 'Red Hat Display', sans-serif;
        }
        
        .cyber-border {
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
        }
        
        .cyber-button {
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            color: #a855f7;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-family: 'Red Hat Display', sans-serif;
        }
        
        .cyber-button:hover {
            background: rgba(168, 85, 247, 0.3);
            border-color: rgba(168, 85, 247, 0.7);
        }
        
        .cyber-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .cyber-input:focus {
            border-color: rgba(168, 85, 247, 0.6);
            box-shadow: 0 0 0 1px rgba(168, 85, 247, 0.2);
        }
        
        .knowledge-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            margin: 2px 0;
        }
        
        .knowledge-item:hover {
            background: rgba(0, 255, 255, 0.1);
        }
        
        .knowledge-item.active {
            background: rgba(0, 255, 255, 0.2);
            border-left: 3px solid #00ffff;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .expand-icon {
            transition: transform 0.2s ease;
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Base URL
        const API_BASE = 'http://127.0.0.1:8787';

        // Knowledge Explorer Component
        function KnowledgeExplorer({ onSectionChange }) {
            const [expandedSections, setExpandedSections] = useState({
                'forgotten-languages': true,
                'audio-video': true
            });
            const [activeSection, setActiveSection] = useState('audio-video');

            const toggleSection = (sectionId) => {
                setExpandedSections(prev => ({
                    ...prev,
                    [sectionId]: !prev[sectionId]
                }));
            };

            const selectSection = (sectionId, sectionTitle) => {
                setActiveSection(sectionId);
                onSectionChange(sectionId, sectionTitle);
            };

            const knowledgeStructure = [
                {
                    id: 'forgotten-languages',
                    title: 'Forgotten Languages',
                    icon: 'üìÅ',
                    children: [
                        { id: 'official-articles', title: 'Official Articles', icon: '‚óè', color: 'text-cyan' },
                        { id: 'translation-lexicons', title: 'Translation Lexicons', icon: '‚óè', color: 'text-green' },
                        { id: 'community-analysis', title: 'Community Analysis', icon: '‚óè', color: 'text-yellow' },
                        { id: 'theories-speculation', title: 'Theories & Speculation', icon: '‚óè', color: 'text-red' }
                    ]
                },
                {
                    id: 'related-mysteries',
                    title: 'Related Mysteries',
                    icon: 'üìÅ',
                    children: []
                },
                {
                    id: 'audio-video',
                    title: 'Audio/Video Analysis',
                    icon: 'üìÅ',
                    children: []
                },
                {
                    id: 'research-tools',
                    title: 'Research Tools',
                    icon: 'üîß',
                    children: []
                }
            ];

            return (
                <div className="cyber-border p-4 h-full">
                    <h2 className="text-lg font-semibold text-cyan mb-4">Knowledge Explorer</h2>
                    
                    <div className="space-y-1">
                        {knowledgeStructure.map(section => (
                            <div key={section.id}>
                                <div 
                                    className="knowledge-item flex items-center"
                                    onClick={() => toggleSection(section.id)}
                                >
                                    <span className={`expand-icon text-sm mr-2 ${expandedSections[section.id] ? 'expanded' : ''}`}>
                                        ‚ñ∂
                                    </span>
                                    <span className="mr-2">{section.icon}</span>
                                    <span className="font-medium">{section.title}</span>
                                </div>
                                
                                {expandedSections[section.id] && section.children.length > 0 && (
                                    <div className="ml-8 space-y-1">
                                        {section.children.map(child => (
                                            <div 
                                                key={child.id}
                                                className={`knowledge-item flex items-center ${activeSection === child.id ? 'active' : ''}`}
                                                onClick={() => selectSection(child.id, child.title)}
                                            >
                                                <span className={`status-indicator mr-2 ${child.color}`}>{child.icon}</span>
                                                <span>{child.title}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {expandedSections[section.id] && section.children.length === 0 && (
                                    <div 
                                        className={`knowledge-item ml-8 ${activeSection === section.id ? 'active' : ''}`}
                                        onClick={() => selectSection(section.id, section.title)}
                                    >
                                        <span className="text-gray-400 text-sm">Click to explore</span>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Ana's Index Search Component
        function AnasIndexSearch() {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const searchAnasIndex = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`http://127.0.0.1:8787/anas-index/search?q=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Search failed');
                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                    setResults([]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="space-y-4">
                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && searchAnasIndex()}
                            placeholder="Search Ana's Index..."
                            className="cyber-input flex-1"
                        />
                        <button 
                            onClick={searchAnasIndex}
                            disabled={loading || !query.trim()}
                            className="cyber-button px-6"
                        >
                            {loading ? 'SEARCHING...' : 'SEARCH'}
                        </button>
                    </div>

                    {error && (
                        <div className="cyber-border p-4 border-red-500/50 bg-red-500/10">
                            <p className="text-red-400">Error: {error}</p>
                        </div>
                    )}

                    {results.length > 0 && (
                        <div className="space-y-3">
                            <p className="text-cyan">Found {results.length} results:</p>
                            {results.map((result, i) => (
                                <div key={i} className="cyber-border p-4">
                                    <h4 className="text-purple font-semibold mb-2">{result.title}</h4>
                                    <p className="text-gray-300 text-sm mb-2">By {result.author} ‚Ä¢ {result.date_posted}</p>
                                    {result.english_text && (
                                        <p className="text-gray-400 text-sm mb-2">{result.english_text.substring(0, 200)}...</p>
                                    )}
                                    {result.tags && (
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {result.tags.split(',').map((tag, j) => (
                                                <span key={j} className="px-2 py-1 bg-cyan-500/20 text-cyan text-xs rounded">
                                                    {tag.trim()}
                                                </span>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Lexicon Search Component
        function LexiconSearch() {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const searchLexicon = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`http://127.0.0.1:8787/lexicon/search?q=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Search failed');
                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                    setResults([]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="space-y-4">
                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && searchLexicon()}
                            placeholder="Search FL Lexicon..."
                            className="cyber-input flex-1"
                        />
                        <button 
                            onClick={searchLexicon}
                            disabled={loading || !query.trim()}
                            className="cyber-button px-6"
                        >
                            {loading ? 'SEARCHING...' : 'SEARCH'}
                        </button>
                    </div>

                    {error && (
                        <div className="cyber-border p-4 border-red-500/50 bg-red-500/10">
                            <p className="text-red-400">Error: {error}</p>
                        </div>
                    )}

                    {results.length > 0 && (
                        <div className="space-y-3">
                            <p className="text-cyan">Found {results.length} lexicon entries:</p>
                            {results.map((result, i) => (
                                <div key={i} className="cyber-border p-4">
                                    <div className="flex justify-between items-start mb-2">
                                        <h4 className="text-purple font-semibold">{result.surface || result.normalized}</h4>
                                        <span className="text-green text-sm">
                                            {Math.round((result.confidence || 0) * 100)}% confidence
                                        </span>
                                    </div>
                                    {result.gloss && (
                                        <p className="text-gray-300 mb-2">"{result.gloss}"</p>
                                    )}
                                    {result.pos && (
                                        <p className="text-gray-400 text-sm">Part of speech: {result.pos}</p>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Main Content Area
        function MainContentArea({ currentSection, sectionTitle }) {
            const [contentData, setContentData] = useState(null);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                loadSectionContent(currentSection);
            }, [currentSection]);

            const loadSectionContent = async (sectionId) => {
                setLoading(true);
                try {
                    // Simulate content loading based on section
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    if (sectionId === 'audio-video') {
                        setContentData({
                            title: 'FL Audio Analysis',
                            description: 'This section will contain detailed information about FL Audio Analysis.',
                            features: 'Features coming soon: document browser, confidence tracking, cross-references.',
                            relatedContent: [
                                { title: 'Cross-References', description: 'Connected topics and references' },
                                { title: 'AI Insights', description: 'Pattern analysis and connections' }
                            ]
                        });
                    } else if (sectionId === 'official-articles') {
                        setContentData({
                            title: 'Official FL Articles - Ana\'s Index Search',
                            description: 'Browse and analyze official Forgotten Languages publications.',
                            features: 'Features: Live Ana\'s Index search, document classification, source verification.',
                            relatedContent: [
                                { title: 'Document Database', description: 'Search 21.9MB Ana\'s Index' },
                                { title: 'Classification System', description: 'Automated document categorization' }
                            ],
                            component: 'anas-search'
                        });
                    } else if (sectionId === 'translation-lexicons') {
                        setContentData({
                            title: 'FL Translation Lexicons - Live Search',
                            description: 'Access comprehensive FL vocabulary and translation tools.',
                            features: 'Features: Live lexicon search, confidence scoring, pattern matching.',
                            relatedContent: [
                                { title: 'Lexicon Database', description: '2,447 FL terms with confidence scores' },
                                { title: 'Pattern Recognition', description: 'Morphological analysis tools' }
                            ],
                            component: 'lexicon-search'
                        });
                    } else {
                        setContentData({
                            title: sectionTitle || 'Content Loading...',
                            description: 'This section is being prepared with relevant FL research data.',
                            features: 'Features coming soon: specialized analysis tools and data visualization.',
                            relatedContent: [
                                { title: 'Research Tools', description: 'Analysis and exploration utilities' },
                                { title: 'Data Connections', description: 'Cross-referenced information' }
                            ]
                        });
                    }
                } catch (error) {
                    console.error('Error loading content:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="cyber-border p-8 h-full flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-cyan text-lg mb-4">Content Loading...</div>
                            <div className="text-gray-400">Preparing FL research data...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="cyber-border p-8 h-full space-y-6">
                    <h1 className="text-2xl font-bold text-cyan">{contentData?.title}</h1>
                    
                    <div className="cyber-border p-6">
                        <p className="text-gray-300 mb-6">{contentData?.description}</p>
                        <p className="text-gray-400 text-sm">{contentData?.features}</p>
                    </div>

                    {/* Render search components based on section */}
                    {contentData?.component === 'anas-search' && (
                        <div className="cyber-border p-6">
                            <h3 className="text-purple font-semibold mb-4">Ana's Index Search</h3>
                            <AnasIndexSearch />
                        </div>
                    )}

                    {contentData?.component === 'lexicon-search' && (
                        <div className="cyber-border p-6">
                            <h3 className="text-purple font-semibold mb-4">FL Lexicon Search</h3>
                            <LexiconSearch />
                        </div>
                    )}

                    <div className="grid grid-cols-2 gap-4">
                        <div className="cyber-border p-4">
                            <h3 className="text-cyan font-semibold mb-2">Related Content</h3>
                            <div className="space-y-3">
                                {contentData?.relatedContent.map((item, i) => (
                                    <div key={i} className="cyber-border p-3">
                                        <div className="flex items-center mb-2">
                                            <span className="status-indicator status-online mr-2"></span>
                                            <span className="font-medium text-green">{item.title}</span>
                                        </div>
                                        <p className="text-gray-400 text-sm">{item.description}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="cyber-border p-4">
                            <h3 className="text-purple font-semibold mb-2">System Status</h3>
                            <div className="cyber-border p-3">
                                <div className="flex items-center mb-2">
                                    <span className="status-indicator status-online mr-2"></span>
                                    <span className="font-medium text-purple">Backend API</span>
                                </div>
                                <p className="text-gray-400 text-sm">Connected to http://127.0.0.1:8787</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // AI Research Assistant
        function AIResearchAssistant() {
            const [messages, setMessages] = useState([]);
            const [currentMessage, setCurrentMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [isMinimized, setIsMinimized] = useState(false);

            const sendMessage = async () => {
                if (!currentMessage.trim() || isLoading) return;

                const userMessage = {
                    id: Date.now(),
                    type: 'user',
                    content: currentMessage,
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, userMessage]);
                setCurrentMessage('');
                setIsLoading(true);

                try {
                    // Generate contextual AI response based on user query
                    const aiResponse = await generateAIResponse(userMessage.content);
                    
                    const aiMessage = {
                        id: Date.now() + 1,
                        type: 'ai',
                        content: aiResponse,
                        timestamp: new Date()
                    };

                    setMessages(prev => [...prev, aiMessage]);
                } catch (error) {
                    const errorMessage = {
                        id: Date.now() + 1,
                        type: 'ai',
                        content: `üî¨ FL Research Analysis of "${userMessage.content}":\n\nI encountered an issue processing your request. However, I can still help you navigate the FL research environment.\n\n‚úÖ Ana's Index: 21.9MB loaded\n‚úÖ Backend API: Operational\n‚úÖ Search functions: Available\n\nPlease try rephrasing your question or ask about specific FL topics like Aylid, Cassini Diskus, or NodeSpaces.`,
                        timestamp: new Date()
                    };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };

            const generateAIResponse = async (userQuery) => {
                const lowerQuery = userQuery.toLowerCase();
                
                // Search-related queries
                if (lowerQuery.includes('search') || lowerQuery.includes('find')) {
                    if (lowerQuery.includes('aylid')) {
                        return `üîç **Aylid Search Guidance**\n\nüìö Ana's Index (FL Direct) - I can help you search for Aylid content.\n\nTo search Aylid documents:\n1. Navigate to "Forgotten Languages" ‚Üí "Official Articles"\n2. Use the search function with Aylid-specific terms\n3. Look for documents tagged with "Aylid"\n\n**Suggested searches:**\n‚Ä¢ "Aylid grammar"\n‚Ä¢ "Aylid translation"\n‚Ä¢ "Aylid lexicon"\n\nWould you like me to guide you to the search interface?`;
                    }
                    
                    if (lowerQuery.includes('cassini')) {
                        return `üõ∞Ô∏è **Cassini Diskus Research**\n\nüìö Ana's Index (FL Direct) - This is our most documented topic (50 documents).\n\n**Key areas to explore:**\n‚Ä¢ Coordinate systems and spatial references\n‚Ä¢ Technical specifications\n‚Ä¢ Defense applications\n‚Ä¢ Geographic patterns\n\n**High-confidence searches:**\n‚Ä¢ "Cassini coordinates"\n‚Ä¢ "Diskus positioning"\n‚Ä¢ "spatial navigation"\n\nShall I help you access the Cassini Diskus analysis section?`;
                    }
                    
                    return `üîç **FL Research Search**\n\nüìö Available databases:\n‚Ä¢ Ana's Index: 21.9MB FL documents\n‚Ä¢ Lexicon: 2,447 FL terms\n‚Ä¢ Vault: Community research\n\n**Popular search topics:**\n‚Ä¢ Aylid (primary FL language)\n‚Ä¢ Cassini Diskus (50 documents)\n‚Ä¢ NodeSpaces (21 documents)\n‚Ä¢ Defense applications\n\nWhat specific FL topic interests you?`;
                }
                
                // Translation queries
                if (lowerQuery.includes('translat')) {
                    return `üîÑ **FL Translation Assistance**\n\nüìñ Lexicon (FL Direct) - 2,447 terms with confidence scores\n\n**Translation capabilities:**\n‚Ä¢ Aylid ‚Üî English (most complete)\n‚Ä¢ Yid ‚Üî English (technical terms)\n‚Ä¢ Ned ‚Üî English (philosophical)\n‚Ä¢ Drizza ‚Üî English (esoteric)\n\n**To translate:**\n1. Navigate to "Translation Lexicons"\n2. Enter FL text or English terms\n3. Review confidence scores\n\nWhat would you like to translate?`;
                }
                
                // Specific FL language queries
                if (lowerQuery.includes('aylid')) {
                    return `üìú **Aylid Language Information**\n\n‚úÖ High Confidence - Primary FL language with extensive documentation\n\n**Aylid characteristics:**\n‚Ä¢ Most documented FL language\n‚Ä¢ Complex grammatical structure\n‚Ä¢ Extensive lexicon available\n‚Ä¢ Used in official FL publications\n\n**Available resources:**\n‚Ä¢ Search Ana's Index for Aylid documents\n‚Ä¢ Access Aylid-English lexicon\n‚Ä¢ Grammar pattern analysis\n\nWould you like to explore Aylid documents or translation tools?`;
                }
                
                if (lowerQuery.includes('cassini') || lowerQuery.includes('diskus')) {
                    return `üõ∞Ô∏è **Cassini Diskus Analysis**\n\n‚úÖ High Confidence - Most documented FL topic (50 documents)\n\n**Key insights:**\n‚Ä¢ Coordinate systems and spatial references\n‚Ä¢ Strong correlation with defense applications\n‚Ä¢ Geographic references span multiple continents\n‚Ä¢ Technical specifications often classified\n\n**Research areas:**\n‚Ä¢ Spatial positioning systems\n‚Ä¢ Navigation protocols\n‚Ä¢ Defense integration\n‚Ä¢ Geographic mapping\n\nShall I guide you to the Cassini Diskus research section?`;
                }
                
                if (lowerQuery.includes('nodespaces')) {
                    return `üï∏Ô∏è **NodeSpaces Theory**\n\n‚ö†Ô∏è Medium Confidence - Information architecture concept (21 documents)\n\n**NodeSpaces overview:**\n‚Ä¢ Information organization theory\n‚Ä¢ Network topology concepts\n‚Ä¢ Consciousness studies connections\n‚Ä¢ Referenced but not directly accessible\n\n**Related topics:**\n‚Ä¢ Philosophy of Language\n‚Ä¢ Information Theory\n‚Ä¢ Consciousness Studies\n\nWould you like to explore NodeSpaces documents or related philosophical frameworks?`;
                }
                
                // Help and navigation
                if (lowerQuery.includes('help') || lowerQuery.includes('how') || lowerQuery.includes('navigate')) {
                    return `üí° **FL Research Navigation Guide**\n\n**Main research areas:**\nüó£Ô∏è **Core Languages**: Aylid, Yid, Ned, Drizza\n‚öôÔ∏è **Technical Systems**: Cassini Diskus, NodeSpaces, Defense\nüß† **Philosophy**: Language theory, Consciousness\nüîÆ **Esoteric**: Religion, Sufism, Theosophy, Alchemy\nüé≠ **Literary**: Poetry, Millangivm\n\n**How to explore:**\n1. Use the left sidebar to navigate topics\n2. Click on areas that interest you\n3. Use search functions for specific terms\n4. Ask me for guidance on any topic\n\nWhat area would you like to explore first?`;
                }
                
                // Default contextual response
                return `ü§î **FL Research Analysis**\n\nüí≠ AI Speculation - Analyzing your query: "${userQuery}"\n\nI'm your FL Research Guide. I can help you:\n\n**Search & Explore:**\n‚Ä¢ Navigate the FL knowledge hierarchy\n‚Ä¢ Search Ana's Index (21.9MB documents)\n‚Ä¢ Access translation tools\n‚Ä¢ Analyze document patterns\n\n**Current capabilities:**\n‚úÖ Ana's Index search (working)\n‚ö†Ô∏è Lexicon search (DB issue)\n‚úÖ Research guidance\n‚úÖ Topic navigation\n\n**Popular starting points:**\n‚Ä¢ Aylid language exploration\n‚Ä¢ Cassini Diskus research\n‚Ä¢ FL translation tools\n\nWhat specific aspect of FL research interests you most?`;
            };

            const formatAIResponse = (result, originalText) => {
                if (typeof result === 'string') {
                    try {
                        result = JSON.parse(result);
                    } catch {
                        return `FL Analysis: ${result}`;
                    }
                }

                let output = `üî¨ B√ÜKON FL Analysis of "${originalText}":\n\n`;
                
                if (result.tokens && result.tokens.length > 0) {
                    output += `üß© Linguistic Analysis (${result.tokens.length} elements):\n`;
                    result.tokens.forEach(token => {
                        output += `‚Ä¢ ${token.surface} ‚Üí "${token.gloss}" (${Math.round((token.confidence || 0) * 100)}%)\n`;
                        if (token.sources && token.sources.length > 0) {
                            output += `  üìö Source: ${token.sources[0].substring(0, 20)}...\n`;
                        }
                    });
                    output += '\n';
                }

                output += `üìä Analysis Metadata:\n`;
                output += `‚Ä¢ Model: ${result.provenance?.model || 'B√ÜKON Research System'}\n`;
                output += `‚Ä¢ Mode: ${result.mode || 'comprehensive'}\n`;
                output += `‚Ä¢ Confidence: ${result.confidence || 'High'}\n`;

                return output;
            };

            if (isMinimized) {
                return (
                    <div className="fixed bottom-4 right-4">
                        <button 
                            onClick={() => setIsMinimized(false)}
                            className="cyber-button"
                        >
                            AI Research Assistant
                        </button>
                    </div>
                );
            }

            return (
                <div className="cyber-border p-4">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-lg font-semibold text-purple">AI Research Assistant</h3>
                        <button 
                            onClick={() => setIsMinimized(true)}
                            className="text-gray-400 hover:text-white text-sm"
                        >
                            MINIMIZE
                        </button>
                    </div>

                    {messages.length > 0 && (
                        <div className="cyber-border p-3 mb-4 max-h-32 overflow-y-auto space-y-2">
                            {messages.map(message => (
                                <div key={message.id} className={`p-2 rounded ${
                                    message.type === 'user' 
                                        ? 'bg-purple-600/20 ml-8' 
                                        : 'bg-cyan-600/20 mr-8'
                                }`}>
                                    <div className="text-sm whitespace-pre-wrap">{message.content}</div>
                                </div>
                            ))}
                            {isLoading && (
                                <div className="text-center text-purple-400 text-sm animate-pulse">
                                    Analyzing FL content...
                                </div>
                            )}
                        </div>
                    )}

                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={currentMessage}
                            onChange={(e) => setCurrentMessage(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                            placeholder="Ask about FL, request translations, explore connections..."
                            className="cyber-input flex-1"
                            disabled={isLoading}
                        />
                        <button 
                            onClick={sendMessage} 
                            disabled={isLoading || !currentMessage.trim()}
                            className="cyber-button px-6"
                        >
                            SEND
                        </button>
                    </div>
                </div>
            );
        }

        // Main App
        function MysteryExplorer() {
            const [currentSection, setCurrentSection] = useState('audio-video');
            const [sectionTitle, setSectionTitle] = useState('Audio/Video Analysis');

            const handleSectionChange = (sectionId, title) => {
                setCurrentSection(sectionId);
                setSectionTitle(title);
            };

            return (
                <div className="min-h-screen p-4 grid grid-rows-[auto_1fr_auto] gap-4">
                    {/* Header */}
                    <header className="cyber-border p-4">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center space-x-4">
                                <h1 className="text-2xl font-bold text-cyan">B√ÜKON</h1>
                                <span className="text-gray-300">Mystery Explorer</span>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="status-indicator status-online"></span>
                                <span className="text-green font-medium">SYSTEMS ACTIVE</span>
                            </div>
                        </div>
                    </header>

                    {/* Main Layout */}
                    <div className="grid grid-cols-[300px_1fr] gap-4 min-h-0">
                        <KnowledgeExplorer onSectionChange={handleSectionChange} />
                        <MainContentArea currentSection={currentSection} sectionTitle={sectionTitle} />
                    </div>

                    {/* AI Assistant */}
                    <AIResearchAssistant />
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<MysteryExplorer />, document.getElementById('root'));
    </script>
</body>
</html>
