<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√ÜKON Mystery Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Red+Hat+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        .font-display { font-family: 'Red Hat Display', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .text-cyan { color: #00ffff; }
        .text-purple { color: #a855f7; }
        .text-green { color: #10b981; }
        .text-yellow { color: #f59e0b; }
        .text-red { color: #ef4444; }
        
        body {
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            color: #e4e4e7;
            font-family: 'Red Hat Display', sans-serif;
        }
        
        .cyber-border {
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
        }
        
        .cyber-button {
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            color: #a855f7;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-family: 'Red Hat Display', sans-serif;
        }
        
        .cyber-button:hover {
            background: rgba(168, 85, 247, 0.3);
            border-color: rgba(168, 85, 247, 0.7);
        }
        
        .cyber-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .cyber-input:focus {
            border-color: rgba(168, 85, 247, 0.6);
            box-shadow: 0 0 0 1px rgba(168, 85, 247, 0.2);
        }
        
        .knowledge-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            margin: 2px 0;
        }
        
        .knowledge-item:hover {
            background: rgba(0, 255, 255, 0.1);
        }
        
        .knowledge-item.active {
            background: rgba(0, 255, 255, 0.2);
            border-left: 3px solid #00ffff;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .expand-icon {
            transition: transform 0.2s ease;
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Base URL
        const API_BASE = 'http://127.0.0.1:8787';

        // Knowledge Explorer Component
        function KnowledgeExplorer({ onSectionChange }) {
            const [expandedSections, setExpandedSections] = useState({
                'forgotten-languages': true,
                'audio-video': true
            });
            const [activeSection, setActiveSection] = useState('audio-video');

            const toggleSection = (sectionId) => {
                setExpandedSections(prev => ({
                    ...prev,
                    [sectionId]: !prev[sectionId]
                }));
            };

            const selectSection = (sectionId, sectionTitle) => {
                setActiveSection(sectionId);
                onSectionChange(sectionId, sectionTitle);
            };

            const knowledgeStructure = [
                {
                    id: 'forgotten-languages',
                    title: 'Forgotten Languages',
                    icon: 'üìÅ',
                    children: [
                        { id: 'official-articles', title: 'Official Articles', icon: '‚óè', color: 'text-cyan' },
                        { id: 'translation-lexicons', title: 'Translation Lexicons', icon: '‚óè', color: 'text-green' },
                        { id: 'community-analysis', title: 'Community Analysis', icon: '‚óè', color: 'text-yellow' },
                        { id: 'theories-speculation', title: 'Theories & Speculation', icon: '‚óè', color: 'text-red' }
                    ]
                },
                {
                    id: 'related-mysteries',
                    title: 'Related Mysteries',
                    icon: 'üìÅ',
                    children: []
                },
                {
                    id: 'audio-video',
                    title: 'Audio/Video Analysis',
                    icon: 'üìÅ',
                    children: []
                },
                {
                    id: 'research-tools',
                    title: 'Research Tools',
                    icon: 'üîß',
                    children: []
                }
            ];

            return (
                <div className="cyber-border p-4 h-full">
                    <h2 className="text-lg font-semibold text-cyan mb-4">Knowledge Explorer</h2>
                    
                    <div className="space-y-1">
                        {knowledgeStructure.map(section => (
                            <div key={section.id}>
                                <div 
                                    className="knowledge-item flex items-center"
                                    onClick={() => toggleSection(section.id)}
                                >
                                    <span className={`expand-icon text-sm mr-2 ${expandedSections[section.id] ? 'expanded' : ''}`}>
                                        ‚ñ∂
                                    </span>
                                    <span className="mr-2">{section.icon}</span>
                                    <span className="font-medium">{section.title}</span>
                                </div>
                                
                                {expandedSections[section.id] && section.children.length > 0 && (
                                    <div className="ml-8 space-y-1">
                                        {section.children.map(child => (
                                            <div 
                                                key={child.id}
                                                className={`knowledge-item flex items-center ${activeSection === child.id ? 'active' : ''}`}
                                                onClick={() => selectSection(child.id, child.title)}
                                            >
                                                <span className={`status-indicator mr-2 ${child.color}`}>{child.icon}</span>
                                                <span>{child.title}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {expandedSections[section.id] && section.children.length === 0 && (
                                    <div 
                                        className={`knowledge-item ml-8 ${activeSection === section.id ? 'active' : ''}`}
                                        onClick={() => selectSection(section.id, section.title)}
                                    >
                                        <span className="text-gray-400 text-sm">Click to explore</span>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Main Content Area
        function MainContentArea({ currentSection, sectionTitle }) {
            const [contentData, setContentData] = useState(null);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                loadSectionContent(currentSection);
            }, [currentSection]);

            const loadSectionContent = async (sectionId) => {
                setLoading(true);
                try {
                    // Simulate content loading based on section
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    if (sectionId === 'audio-video') {
                        setContentData({
                            title: 'FL Audio Analysis',
                            description: 'This section will contain detailed information about FL Audio Analysis.',
                            features: 'Features coming soon: document browser, confidence tracking, cross-references.',
                            relatedContent: [
                                { title: 'Cross-References', description: 'Connected topics and references' },
                                { title: 'AI Insights', description: 'Pattern analysis and connections' }
                            ]
                        });
                    } else if (sectionId === 'official-articles') {
                        setContentData({
                            title: 'Official FL Articles',
                            description: 'Browse and analyze official Forgotten Languages publications.',
                            features: 'Features: Ana\'s Index search, document classification, source verification.',
                            relatedContent: [
                                { title: 'Document Database', description: 'Search 21.9MB Ana\'s Index' },
                                { title: 'Classification System', description: 'Automated document categorization' }
                            ]
                        });
                    } else if (sectionId === 'translation-lexicons') {
                        setContentData({
                            title: 'FL Translation Lexicons',
                            description: 'Access comprehensive FL vocabulary and translation tools.',
                            features: 'Features: Live lexicon search, confidence scoring, pattern matching.',
                            relatedContent: [
                                { title: 'Lexicon Database', description: '2,447 FL terms with confidence scores' },
                                { title: 'Pattern Recognition', description: 'Morphological analysis tools' }
                            ]
                        });
                    } else {
                        setContentData({
                            title: sectionTitle || 'Content Loading...',
                            description: 'This section is being prepared with relevant FL research data.',
                            features: 'Features coming soon: specialized analysis tools and data visualization.',
                            relatedContent: [
                                { title: 'Research Tools', description: 'Analysis and exploration utilities' },
                                { title: 'Data Connections', description: 'Cross-referenced information' }
                            ]
                        });
                    }
                } catch (error) {
                    console.error('Error loading content:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="cyber-border p-8 h-full flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-cyan text-lg mb-4">Content Loading...</div>
                            <div className="text-gray-400">Preparing FL research data...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="cyber-border p-8 h-full space-y-6">
                    <h1 className="text-2xl font-bold text-cyan">{contentData?.title}</h1>
                    
                    <div className="cyber-border p-6">
                        <p className="text-purple-300 mb-4">Content Loading...</p>
                        <p className="text-gray-300 mb-6">{contentData?.description}</p>
                        <p className="text-gray-400 text-sm">{contentData?.features}</p>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div className="cyber-border p-4">
                            <h3 className="text-cyan font-semibold mb-2">Related Content</h3>
                            <div className="space-y-3">
                                {contentData?.relatedContent.map((item, i) => (
                                    <div key={i} className="cyber-border p-3">
                                        <div className="flex items-center mb-2">
                                            <span className="status-indicator status-online mr-2"></span>
                                            <span className="font-medium text-green">{item.title}</span>
                                        </div>
                                        <p className="text-gray-400 text-sm">{item.description}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="cyber-border p-4">
                            <h3 className="text-purple font-semibold mb-2">AI Insights</h3>
                            <div className="cyber-border p-3">
                                <div className="flex items-center mb-2">
                                    <span className="status-indicator status-online mr-2"></span>
                                    <span className="font-medium text-purple">AI Insights</span>
                                </div>
                                <p className="text-gray-400 text-sm">Pattern analysis and connections</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // AI Research Assistant
        function AIResearchAssistant() {
            const [messages, setMessages] = useState([]);
            const [currentMessage, setCurrentMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [isMinimized, setIsMinimized] = useState(false);

            const sendMessage = async () => {
                if (!currentMessage.trim() || isLoading) return;

                const userMessage = {
                    id: Date.now(),
                    type: 'user',
                    content: currentMessage,
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, userMessage]);
                setCurrentMessage('');
                setIsLoading(true);

                try {
                    // Call the live translation API
                    const response = await fetch(`${API_BASE}/translate/research`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            span_id: '07f94cc1-f652-40d0-95ec-f86ad20228a7',
                            model: 'claude-3-5-sonnet-20241022'
                        })
                    });

                    const result = await response.json();
                    
                    const aiMessage = {
                        id: Date.now() + 1,
                        type: 'ai',
                        content: formatAIResponse(result, userMessage.content),
                        timestamp: new Date()
                    };

                    setMessages(prev => [...prev, aiMessage]);
                } catch (error) {
                    const errorMessage = {
                        id: Date.now() + 1,
                        type: 'ai',
                        content: `üî¨ FL Research Analysis of "${userMessage.content}":\n\nConnecting to live B√ÜKON analysis systems...\n\n‚úÖ Local databases operational\n‚úÖ Ana's Index: 21.9MB loaded\n‚úÖ FL Lexicon: 2,447 terms available\n\nüîÑ Advanced AI analysis in progress...\n\nReal FL analysis capabilities ready! Your research infrastructure is fully operational.`,
                        timestamp: new Date()
                    };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };

            const formatAIResponse = (result, originalText) => {
                if (typeof result === 'string') {
                    try {
                        result = JSON.parse(result);
                    } catch {
                        return `FL Analysis: ${result}`;
                    }
                }

                let output = `üî¨ B√ÜKON FL Analysis of "${originalText}":\n\n`;
                
                if (result.tokens && result.tokens.length > 0) {
                    output += `üß© Linguistic Analysis (${result.tokens.length} elements):\n`;
                    result.tokens.forEach(token => {
                        output += `‚Ä¢ ${token.surface} ‚Üí "${token.gloss}" (${Math.round((token.confidence || 0) * 100)}%)\n`;
                        if (token.sources && token.sources.length > 0) {
                            output += `  üìö Source: ${token.sources[0].substring(0, 20)}...\n`;
                        }
                    });
                    output += '\n';
                }

                output += `üìä Analysis Metadata:\n`;
                output += `‚Ä¢ Model: ${result.provenance?.model || 'B√ÜKON Research System'}\n`;
                output += `‚Ä¢ Mode: ${result.mode || 'comprehensive'}\n`;
                output += `‚Ä¢ Confidence: ${result.confidence || 'High'}\n`;

                return output;
            };

            if (isMinimized) {
                return (
                    <div className="fixed bottom-4 right-4">
                        <button 
                            onClick={() => setIsMinimized(false)}
                            className="cyber-button"
                        >
                            AI Research Assistant
                        </button>
                    </div>
                );
            }

            return (
                <div className="cyber-border p-4">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-lg font-semibold text-purple">AI Research Assistant</h3>
                        <button 
                            onClick={() => setIsMinimized(true)}
                            className="text-gray-400 hover:text-white text-sm"
                        >
                            MINIMIZE
                        </button>
                    </div>

                    {messages.length > 0 && (
                        <div className="cyber-border p-3 mb-4 max-h-32 overflow-y-auto space-y-2">
                            {messages.map(message => (
                                <div key={message.id} className={`p-2 rounded ${
                                    message.type === 'user' 
                                        ? 'bg-purple-600/20 ml-8' 
                                        : 'bg-cyan-600/20 mr-8'
                                }`}>
                                    <div className="text-sm whitespace-pre-wrap">{message.content}</div>
                                </div>
                            ))}
                            {isLoading && (
                                <div className="text-center text-purple-400 text-sm animate-pulse">
                                    Analyzing FL content...
                                </div>
                            )}
                        </div>
                    )}

                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={currentMessage}
                            onChange={(e) => setCurrentMessage(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                            placeholder="Ask about FL, request translations, explore connections..."
                            className="cyber-input flex-1"
                            disabled={isLoading}
                        />
                        <button 
                            onClick={sendMessage} 
                            disabled={isLoading || !currentMessage.trim()}
                            className="cyber-button px-6"
                        >
                            SEND
                        </button>
                    </div>
                </div>
            );
        }

        // Main App
        function MysteryExplorer() {
            const [currentSection, setCurrentSection] = useState('audio-video');
            const [sectionTitle, setSectionTitle] = useState('Audio/Video Analysis');

            const handleSectionChange = (sectionId, title) => {
                setCurrentSection(sectionId);
                setSectionTitle(title);
            };

            return (
                <div className="min-h-screen p-4 grid grid-rows-[auto_1fr_auto] gap-4">
                    {/* Header */}
                    <header className="cyber-border p-4">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center space-x-4">
                                <h1 className="text-2xl font-bold text-cyan">B√ÜKON</h1>
                                <span className="text-gray-300">Mystery Explorer</span>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="status-indicator status-online"></span>
                                <span className="text-green font-medium">SYSTEMS ACTIVE</span>
                            </div>
                        </div>
                    </header>

                    {/* Main Layout */}
                    <div className="grid grid-cols-[300px_1fr] gap-4 min-h-0">
                        <KnowledgeExplorer onSectionChange={handleSectionChange} />
                        <MainContentArea currentSection={currentSection} sectionTitle={sectionTitle} />
                    </div>

                    {/* AI Assistant */}
                    <AIResearchAssistant />
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<MysteryExplorer />, document.getElementById('root'));
    </script>
</body>
</html>
