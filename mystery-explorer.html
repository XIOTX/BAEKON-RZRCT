<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√ÜKON Mystery Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Red+Hat+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        .font-display { font-family: 'Red Hat Display', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .text-cyan { color: #00ffff; }
        .text-purple { color: #a855f7; }
        .text-green { color: #10b981; }
        .text-yellow { color: #f59e0b; }
        .text-red { color: #ef4444; }
        
        body {
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            color: #e4e4e7;
            font-family: 'Red Hat Display', sans-serif;
        }
        
        .cyber-border {
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
        }
        
        .cyber-button {
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            color: #a855f7;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-family: 'Red Hat Display', sans-serif;
        }
        
        .cyber-button:hover {
            background: rgba(168, 85, 247, 0.3);
            border-color: rgba(168, 85, 247, 0.7);
        }
        
        .cyber-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .cyber-input:focus {
            border-color: rgba(168, 85, 247, 0.6);
            box-shadow: 0 0 0 1px rgba(168, 85, 247, 0.2);
        }
        
        .file-explorer-item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            min-height: 24px;
        }

        .file-explorer-item:hover {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
        }

        .file-explorer-item.selected {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border-left: 3px solid #00ffff;
        }

        .folder-item {
            font-weight: 500;
        }

        .file-item {
            font-weight: 400;
        }

        .file-icon, .expand-icon {
            flex-shrink: 0;
            width: 16px;
            text-align: center;
        }

        .item-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-size {
            flex-shrink: 0;
            font-size: 11px;
            color: #888;
            margin-left: auto;
        }

        .expand-arrow {
            flex-shrink: 0;
            font-size: 10px;
            color: #666;
            margin-left: auto;
        }

        .folder-contents {
            border-left: 1px solid rgba(0, 255, 255, 0.2);
            margin-left: 8px;
        }

        .file-explorer-tree {
            padding: 8px 0;
        }

        .breadcrumb-item {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
            transition: background 0.2s ease;
        }

        .breadcrumb-item:hover {
            background: rgba(0, 255, 255, 0.1);
            color: #00ffff;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-online {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .expand-icon {
            transition: transform 0.2s ease;
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Base URL
        const API_BASE = 'http://127.0.0.1:8787';

        // File Explorer Component
        function KnowledgeExplorer({ onSectionChange }) {
            const [expandedFolders, setExpandedFolders] = useState({
                'forgotten-languages': true
            });
            const [selectedFile, setSelectedFile] = useState('');
            const [currentPath, setCurrentPath] = useState([]);

            const toggleFolder = (folderPath) => {
                setExpandedFolders(prev => ({
                    ...prev,
                    [folderPath]: !prev[folderPath]
                }));
            };

            const selectFile = (filePath, fileName, fileType) => {
                setSelectedFile(filePath);
                onSectionChange(filePath, fileName, fileType);
            };

            const navigateToPath = (pathArray) => {
                setCurrentPath(pathArray);
            };

            const fileSystem = [
                {
                    type: 'folder',
                    name: 'forgotten-languages',
                    path: 'forgotten-languages',
                    children: [
                        {
                            type: 'folder',
                            name: 'official',
                            path: 'forgotten-languages/official',
                            children: [
                                { type: 'file', name: 'anas-index.db', path: 'forgotten-languages/official/anas-index.db', size: '21.9MB', fileType: 'database', icon: 'üóÑÔ∏è' },
                                { type: 'file', name: 'articles.json', path: 'forgotten-languages/official/articles.json', size: '2.4MB', fileType: 'json', icon: 'üìÑ' },
                                { type: 'file', name: 'document-index.txt', path: 'forgotten-languages/official/document-index.txt', size: '45KB', fileType: 'text', icon: 'üìù' }
                            ]
                        },
                        {
                            type: 'folder',
                            name: 'languages',
                            path: 'forgotten-languages/languages',
                            children: [
                                { type: 'file', name: 'aylid.lexicon', path: 'forgotten-languages/languages/aylid.lexicon', size: '1.2MB', fileType: 'lexicon', icon: 'üìú' },
                                { type: 'file', name: 'yid.lexicon', path: 'forgotten-languages/languages/yid.lexicon', size: '856KB', fileType: 'lexicon', icon: 'üìú' },
                                { type: 'file', name: 'ned.lexicon', path: 'forgotten-languages/languages/ned.lexicon', size: '432KB', fileType: 'lexicon', icon: 'üìú' },
                                { type: 'file', name: 'drizza.lexicon', path: 'forgotten-languages/languages/drizza.lexicon', size: '234KB', fileType: 'lexicon', icon: 'üìú' }
                            ]
                        },
                        {
                            type: 'folder',
                            name: 'translations',
                            path: 'forgotten-languages/translations',
                            children: [
                                { type: 'file', name: 'aylid-english.dict', path: 'forgotten-languages/translations/aylid-english.dict', size: '2.1MB', fileType: 'dictionary', icon: 'üîÑ' },
                                { type: 'file', name: 'grammar-patterns.xml', path: 'forgotten-languages/translations/grammar-patterns.xml', size: '567KB', fileType: 'xml', icon: 'üìã' }
                            ]
                        }
                    ]
                },
                {
                    type: 'folder',
                    name: 'technical-systems',
                    path: 'technical-systems',
                    children: [
                        {
                            type: 'folder',
                            name: 'cassini-diskus',
                            path: 'technical-systems/cassini-diskus',
                            children: [
                                { type: 'file', name: 'coordinates.dat', path: 'technical-systems/cassini-diskus/coordinates.dat', size: '3.2MB', fileType: 'data', icon: 'üìä' },
                                { type: 'file', name: 'specifications.md', path: 'technical-systems/cassini-diskus/specifications.md', size: '124KB', fileType: 'markdown', icon: 'üìù' },
                                { type: 'file', name: 'defense-integration.enc', path: 'technical-systems/cassini-diskus/defense-integration.enc', size: '892KB', fileType: 'encrypted', icon: 'üîí' },
                                { type: 'file', name: 'spatial-analysis.py', path: 'technical-systems/cassini-diskus/spatial-analysis.py', size: '78KB', fileType: 'python', icon: 'üêç' }
                            ]
                        },
                        {
                            type: 'folder',
                            name: 'nodespaces',
                            path: 'technical-systems/nodespaces',
                            children: [
                                { type: 'file', name: 'topology.graph', path: 'technical-systems/nodespaces/topology.graph', size: '567KB', fileType: 'graph', icon: 'üï∏Ô∏è' },
                                { type: 'file', name: 'theory.pdf', path: 'technical-systems/nodespaces/theory.pdf', size: '1.8MB', fileType: 'pdf', icon: 'üìÑ' },
                                { type: 'file', name: 'network-map.json', path: 'technical-systems/nodespaces/network-map.json', size: '234KB', fileType: 'json', icon: 'üó∫Ô∏è' }
                            ]
                        }
                    ]
                },
                {
                    type: 'folder',
                    name: 'research-vault',
                    path: 'research-vault',
                    children: [
                        { type: 'file', name: 'community-findings.db', path: 'research-vault/community-findings.db', size: '4.7MB', fileType: 'database', icon: 'üóÑÔ∏è' },
                        { type: 'file', name: 'analysis-reports.json', path: 'research-vault/analysis-reports.json', size: '892KB', fileType: 'json', icon: 'üìÑ' },
                        { type: 'file', name: 'collaborative-notes.md', path: 'research-vault/collaborative-notes.md', size: '156KB', fileType: 'markdown', icon: 'üìù' }
                    ]
                },
                {
                    type: 'folder',
                    name: 'philosophy',
                    path: 'philosophy',
                    children: [
                        { type: 'file', name: 'consciousness-studies.md', path: 'philosophy/consciousness-studies.md', size: '234KB', fileType: 'markdown', icon: 'üí≠' },
                        { type: 'file', name: 'language-theory.pdf', path: 'philosophy/language-theory.pdf', size: '1.1MB', fileType: 'pdf', icon: 'üìÑ' },
                        { type: 'file', name: 'information-theory.tex', path: 'philosophy/information-theory.tex', size: '445KB', fileType: 'tex', icon: 'üì°' }
                    ]
                },
                {
                    type: 'folder',
                    name: 'esoteric',
                    path: 'esoteric',
                    children: [
                        { type: 'file', name: 'sufism-connections.md', path: 'esoteric/sufism-connections.md', size: '178KB', fileType: 'markdown', icon: 'üåô' },
                        { type: 'file', name: 'theosophy-analysis.pdf', path: 'esoteric/theosophy-analysis.pdf', size: '923KB', fileType: 'pdf', icon: '‚ú®' },
                        { type: 'file', name: 'alchemy-symbols.svg', path: 'esoteric/alchemy-symbols.svg', size: '67KB', fileType: 'svg', icon: '‚öóÔ∏è' }
                    ]
                },
                {
                    type: 'folder',
                    name: 'literary',
                    path: 'literary',
                    children: [
                        { type: 'file', name: 'poetry-collection.txt', path: 'literary/poetry-collection.txt', size: '345KB', fileType: 'text', icon: 'üìù' },
                        { type: 'file', name: 'millangivm-complete.epub', path: 'literary/millangivm-complete.epub', size: '2.1MB', fileType: 'epub', icon: 'üìñ' }
                    ]
                }
            ];

            const renderFileSystemItem = (item, depth = 0) => {
                const isExpanded = expandedFolders[item.path];
                const isSelected = selectedFile === item.path;
                const indentStyle = { paddingLeft: `${depth * 20 + 8}px` };

                if (item.type === 'folder') {
                    return (
                        <div key={item.path}>
                            <div 
                                className={`file-explorer-item folder-item ${isSelected ? 'selected' : ''}`}
                                style={indentStyle}
                                onClick={() => toggleFolder(item.path)}
                            >
                                <span className={`expand-icon ${isExpanded ? 'expanded' : ''}`}>
                                    {isExpanded ? 'üìÇ' : 'üìÅ'}
                                </span>
                                <span className="item-name">{item.name}</span>
                                <span className="expand-arrow">{isExpanded ? '‚ñº' : '‚ñ∂'}</span>
                            </div>
                            {isExpanded && item.children && (
                                <div className="folder-contents">
                                    {item.children.map(child => renderFileSystemItem(child, depth + 1))}
                                </div>
                            )}
                        </div>
                    );
                } else {
                    return (
                        <div 
                            key={item.path}
                            className={`file-explorer-item file-item ${isSelected ? 'selected' : ''}`}
                            style={indentStyle}
                            onClick={() => selectFile(item.path, item.name, item.fileType)}
                        >
                            <span className="file-icon">{item.icon}</span>
                            <span className="item-name">{item.name}</span>
                            <span className="file-size">{item.size}</span>
                        </div>
                    );
                }
            };

            return (
                <div className="cyber-border p-0 h-full flex flex-col">
                    {/* Explorer Header */}
                    <div className="p-4 border-b border-cyan/30">
                        <h2 className="text-lg font-semibold text-cyan mb-2">üóÇÔ∏è FL Research Explorer</h2>
                        <div className="flex items-center space-x-2 text-sm">
                            <span className="status-indicator status-online"></span>
                            <span className="text-green">Connected</span>
                        </div>
                    </div>

                    {/* Breadcrumb */}
                    {currentPath.length > 0 && (
                        <div className="px-4 py-2 bg-gray-900/50 border-b border-cyan/20">
                            <div className="flex items-center space-x-1 text-sm text-gray-300">
                                <span className="cursor-pointer hover:text-cyan" onClick={() => navigateToPath([])}>üè†</span>
                                {currentPath.map((folder, index) => (
                                    <React.Fragment key={index}>
                                        <span>/</span>
                                        <span className="cursor-pointer hover:text-cyan" onClick={() => navigateToPath(currentPath.slice(0, index + 1))}>
                                            {folder}
                                        </span>
                                    </React.Fragment>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* File Tree */}
                    <div className="flex-1 overflow-auto">
                        <div className="file-explorer-tree">
                            {fileSystem.map(item => renderFileSystemItem(item))}
                        </div>
                    </div>
                </div>
            );
        }

        // Ana's Index Search Component
        function AnasIndexSearch() {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const searchAnasIndex = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`http://127.0.0.1:8787/anas-index/search?q=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Search failed');
                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                    setResults([]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="space-y-4">
                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && searchAnasIndex()}
                            placeholder="Search Ana's Index..."
                            className="cyber-input flex-1"
                        />
                        <button 
                            onClick={searchAnasIndex}
                            disabled={loading || !query.trim()}
                            className="cyber-button px-6"
                        >
                            {loading ? 'SEARCHING...' : 'SEARCH'}
                        </button>
                    </div>

                    {error && (
                        <div className="cyber-border p-4 border-red-500/50 bg-red-500/10">
                            <p className="text-red-400">Error: {error}</p>
                        </div>
                    )}

                    {results.length > 0 && (
                        <div className="space-y-3">
                            <p className="text-cyan">Found {results.length} results:</p>
                            {results.map((result, i) => (
                                <div key={i} className="cyber-border p-4">
                                    <h4 className="text-purple font-semibold mb-2">{result.title}</h4>
                                    <p className="text-gray-300 text-sm mb-2">By {result.author} ‚Ä¢ {result.date_posted}</p>
                                    {result.english_text && (
                                        <p className="text-gray-400 text-sm mb-2">{result.english_text.substring(0, 200)}...</p>
                                    )}
                                    {result.tags && (
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {result.tags.split(',').map((tag, j) => (
                                                <span key={j} className="px-2 py-1 bg-cyan-500/20 text-cyan text-xs rounded">
                                                    {tag.trim()}
                                                </span>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Vault Search Component
        function VaultSearch() {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const searchVault = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`http://127.0.0.1:8787/vault/search?q=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Vault search failed');
                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                    setResults([]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="space-y-4">
                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && searchVault()}
                            placeholder="Search community research vault..."
                            className="cyber-input flex-1"
                        />
                        <button 
                            onClick={searchVault}
                            disabled={loading || !query.trim()}
                            className="cyber-button"
                        >
                            {loading ? 'Searching...' : 'Search'}
                        </button>
                    </div>

                    {error && (
                        <div className="cyber-border p-4 bg-red-900/20 border-red-500/50">
                            <div className="text-red-400">‚ùå Search Error: {error}</div>
                        </div>
                    )}

                    {results.length > 0 && (
                        <div className="space-y-3">
                            <div className="text-sm text-gray-400">
                                Found {results.length} community research results
                            </div>
                            {results.map((result, index) => (
                                <div key={index} className="cyber-border p-4">
                                    <div className="flex items-start justify-between mb-2">
                                        <h4 className="font-semibold text-cyan">{result.title || 'Community Finding'}</h4>
                                        <span className="text-xs text-gray-500">Community</span>
                                    </div>
                                    <p className="text-gray-300 text-sm mb-2">{result.content || result.excerpt}</p>
                                    {result.confidence && (
                                        <div className="text-xs text-yellow-400">
                                            Confidence: {result.confidence}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}

                    {query && results.length === 0 && !loading && !error && (
                        <div className="text-center text-gray-400 py-8">
                            No community research found for "{query}"
                        </div>
                    )}
                </div>
            );
        }

        // Lexicon Search Component
        function LexiconSearch() {
            const [query, setQuery] = useState('');
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const searchLexicon = async () => {
                if (!query.trim()) return;
                
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`http://127.0.0.1:8787/lexicon/search?q=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Search failed');
                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                    setResults([]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="space-y-4">
                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && searchLexicon()}
                            placeholder="Search FL Lexicon..."
                            className="cyber-input flex-1"
                        />
                        <button 
                            onClick={searchLexicon}
                            disabled={loading || !query.trim()}
                            className="cyber-button px-6"
                        >
                            {loading ? 'SEARCHING...' : 'SEARCH'}
                        </button>
                    </div>

                    {error && (
                        <div className="cyber-border p-4 border-red-500/50 bg-red-500/10">
                            <p className="text-red-400">Error: {error}</p>
                        </div>
                    )}

                    {results.length > 0 && (
                        <div className="space-y-3">
                            <p className="text-cyan">Found {results.length} lexicon entries:</p>
                            {results.map((result, i) => (
                                <div key={i} className="cyber-border p-4">
                                    <div className="flex justify-between items-start mb-2">
                                        <h4 className="text-purple font-semibold">{result.surface || result.normalized}</h4>
                                        <span className="text-green text-sm">
                                            {Math.round((result.confidence || 0) * 100)}% confidence
                                        </span>
                                    </div>
                                    {result.gloss && (
                                        <p className="text-gray-300 mb-2">"{result.gloss}"</p>
                                    )}
                                    {result.pos && (
                                        <p className="text-gray-400 text-sm">Part of speech: {result.pos}</p>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Main Content Area
        function MainContentArea({ currentSection, sectionTitle, fileType }) {
            const [contentData, setContentData] = useState(null);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                loadSectionContent(currentSection, sectionTitle, fileType);
            }, [currentSection, sectionTitle, fileType]);

            const loadSectionContent = async (filePath, fileName, fileType) => {
                console.log('Loading file:', { filePath, fileName, fileType });
                
                if (!filePath) {
                    setContentData({
                        type: 'welcome',
                        title: 'üóÇÔ∏è FL Research Explorer',
                        description: 'Welcome to the Forgotten Languages Research Environment',
                        content: 'Select a file from the explorer to begin your research journey.',
                        features: 'Navigate through folders and click on files to access analysis tools and data.'
                    });
                    return;
                }

                setLoading(true);
                try {
                    // Simulate file loading
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // Handle different file types based on path and fileType
                    if (filePath.includes('anas-index.db')) {
                        setContentData({
                            type: 'database',
                            title: 'üóÑÔ∏è Ana\'s Index Database',
                            path: filePath,
                            size: '21.9MB',
                            description: 'Official Forgotten Languages Document Database',
                            content: 'This database contains the complete index of official FL documents with full-text search capabilities.',
                            component: 'anas-search',
                            metadata: {
                                'Document Count': '~2,400 articles',
                                'Last Updated': 'Real-time',
                                'Confidence Level': 'High (FL Direct)',
                                'Search Type': 'Semantic full-text'
                            },
                            features: 'Live search, document classification, source verification, confidence scoring.'
                        });
                    } else if (filePath.includes('.lexicon')) {
                        const language = fileName?.split('.')[0] || 'Unknown';
                        setContentData({
                            type: 'lexicon',
                            title: `üìú ${language.charAt(0).toUpperCase() + language.slice(1)} Lexicon`,
                            path: filePath,
                            description: `Comprehensive vocabulary and grammar patterns for ${language}`,
                            content: `Interactive lexicon with translation capabilities and morphological analysis for the ${language} language.`,
                            component: 'lexicon-search',
                            metadata: {
                                'Language': language,
                                'Term Count': language === 'aylid' ? '~1,200 terms' : '~400-800 terms',
                                'Confidence Level': language === 'aylid' ? 'High' : 'Medium',
                                'Translation Pairs': `${language} ‚Üî English`
                            },
                            features: 'Live lexicon search, confidence scoring, pattern matching, morphological analysis.'
                        });
                    } else if (filePath.includes('community-findings.db')) {
                        setContentData({
                            type: 'database',
                            title: 'üóÑÔ∏è Community Research Vault',
                            path: filePath,
                            size: '4.7MB',
                            description: 'Collaborative Research Findings Database',
                            content: 'Community-contributed research, analysis, and theories about Forgotten Languages.',
                            component: 'vault-search',
                            metadata: {
                                'Contributors': 'FL Research Community',
                                'Content Type': 'Analysis & Theories',
                                'Confidence Level': 'Variable (Community)',
                                'Last Updated': 'Continuous'
                            },
                            features: 'Community search, collaborative findings, theory exploration, cross-references.'
                        });
                    } else if (filePath.includes('coordinates.dat')) {
                        setContentData({
                            type: 'data',
                            title: 'üìä Cassini Diskus Coordinates',
                            path: filePath,
                            size: '3.2MB',
                            description: 'Spatial Positioning Data',
                            content: 'Coordinate system data and spatial references from Cassini Diskus research. Contains geographic positioning information and spatial analysis patterns.',
                            metadata: {
                                'Data Points': '~50,000 coordinates',
                                'Format': 'Binary spatial data',
                                'Confidence Level': 'High (FL Direct)',
                                'Geographic Scope': 'Global references'
                            },
                            features: 'Coordinate visualization, spatial analysis, geographic pattern recognition.'
                        });
                    } else if (filePath.includes('defense-integration.enc')) {
                        setContentData({
                            type: 'encrypted',
                            title: 'üîí Defense Integration (Encrypted)',
                            path: filePath,
                            size: '892KB',
                            description: 'Classified Defense Applications',
                            content: 'This file contains encrypted information related to defense system integration. Access requires proper security clearance and decryption keys.',
                            metadata: {
                                'Encryption': 'AES-256',
                                'Classification': 'Restricted',
                                'Access Level': 'Authorized Personnel Only',
                                'Content Type': 'Defense Integration Specs'
                            },
                            features: 'Encrypted storage, access control, security protocols, clearance verification.'
                        });
                    } else if (filePath.includes('specifications.md')) {
                        setContentData({
                            type: 'document',
                            title: 'üìù Cassini Diskus Specifications',
                            path: filePath,
                            size: '124KB',
                            description: 'Technical Specifications Document',
                            content: 'Detailed technical specifications and operational parameters for the Cassini Diskus system. Includes coordinate systems, positioning algorithms, and integration protocols.',
                            metadata: {
                                'Format': 'Markdown',
                                'Content Type': 'Technical Documentation',
                                'Editable': 'Yes',
                                'Version Control': 'Git tracked'
                            },
                            features: 'Document viewer, technical analysis, specification browser, cross-references.'
                        });
                    } else if (filePath.includes('topology.graph')) {
                        setContentData({
                            type: 'graph',
                            title: 'üï∏Ô∏è NodeSpaces Topology',
                            path: filePath,
                            size: '567KB',
                            description: 'Network Topology Graph',
                            content: 'NodeSpaces network topology visualization showing information architecture patterns and node relationships within the FL knowledge system.',
                            metadata: {
                                'Node Count': '~2,100 nodes',
                                'Edge Count': '~8,400 connections',
                                'Graph Type': 'Directed network',
                                'Visualization': 'Interactive'
                            },
                            features: 'Graph visualization, network analysis, node exploration, relationship mapping.'
                        });
                    } else {
                        setContentData({
                            type: 'generic',
                            title: `üìÑ ${fileName}`,
                            path: filePath,
                            description: 'FL Research File',
                            content: `Analysis and content for ${fileName} will be displayed here. This file contains FL research data and can be explored using the appropriate tools.`,
                            metadata: {
                                'File Type': fileType?.toUpperCase() || 'Unknown',
                                'Status': 'Available',
                                'Tools': 'Viewer & Analysis'
                            },
                            features: 'File analysis, content exploration, research tools, data visualization.'
                        });
                    }
                } catch (error) {
                    console.error('Error loading content:', error);
                    setContentData({
                        type: 'error',
                        title: '‚ùå Error Loading File',
                        description: 'Unable to load the selected file',
                        content: 'Please try selecting a different file or check your connection.'
                    });
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return (
                    <div className="cyber-border p-8 h-full flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-cyan text-lg mb-4">Content Loading...</div>
                            <div className="text-gray-400">Preparing FL research data...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="cyber-border p-8 h-full space-y-6 overflow-auto">
                    {/* File Header */}
                    <div className="border-b border-cyan/30 pb-4">
                        <h1 className="text-2xl font-bold text-cyan mb-2">{contentData?.title}</h1>
                        {contentData?.path && (
                            <div className="text-sm text-gray-400 font-mono">
                                üìÅ {contentData.path}
                                {contentData?.size && <span className="ml-4">üìè {contentData.size}</span>}
                            </div>
                        )}
                    </div>
                    
                    {/* File Description */}
                    <div className="cyber-border p-6">
                        <h3 className="text-lg font-semibold text-purple mb-3">Description</h3>
                        <p className="text-gray-300 mb-4">{contentData?.description}</p>
                        <p className="text-gray-400">{contentData?.content}</p>
                    </div>

                    {/* File Metadata */}
                    {contentData?.metadata && (
                        <div className="cyber-border p-6">
                            <h3 className="text-lg font-semibold text-cyan mb-4">File Information</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {Object.entries(contentData.metadata).map(([key, value]) => (
                                    <div key={key} className="flex justify-between items-center py-2 border-b border-gray-700">
                                        <span className="text-gray-400 font-medium">{key}:</span>
                                        <span className="text-gray-200">{value}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Features */}
                    {contentData?.features && (
                        <div className="cyber-border p-6">
                            <h3 className="text-lg font-semibold text-green mb-3">Available Features</h3>
                            <p className="text-gray-300">{contentData.features}</p>
                        </div>
                    )}

                    {/* Interactive Components */}
                    {contentData?.component === 'anas-search' && (
                        <div className="cyber-border p-6">
                            <h3 className="text-lg font-semibold text-purple mb-4">üîç Ana's Index Search Interface</h3>
                            <AnasIndexSearch />
                        </div>
                    )}

                    {contentData?.component === 'lexicon-search' && (
                        <div className="cyber-border p-6">
                            <h3 className="text-lg font-semibold text-purple mb-4">üìú FL Lexicon Search Interface</h3>
                            <LexiconSearch />
                        </div>
                    )}

                    {contentData?.component === 'vault-search' && (
                        <div className="cyber-border p-6">
                            <h3 className="text-lg font-semibold text-purple mb-4">üóÑÔ∏è Research Vault Search Interface</h3>
                            <VaultSearch />
                        </div>
                    )}

                    {/* File Type Specific Content */}
                    {contentData?.type === 'encrypted' && (
                        <div className="cyber-border p-6 bg-red-900/20 border-red-500/50">
                            <h3 className="text-lg font-semibold text-red-400 mb-3">üîí Access Restricted</h3>
                            <p className="text-red-300 mb-3">This file requires security clearance to access.</p>
                            <div className="cyber-border p-4 bg-red-900/30">
                                <div className="text-red-200 text-sm">
                                    <div>üîê Encryption: {contentData.metadata?.['Encryption']}</div>
                                    <div>üõ°Ô∏è Classification: {contentData.metadata?.['Classification']}</div>
                                    <div>üë§ Access Level: {contentData.metadata?.['Access Level']}</div>
                                </div>
                            </div>
                        </div>
                    )}

                    {contentData?.type === 'graph' && (
                        <div className="cyber-border p-6">
                            <h3 className="text-lg font-semibold text-cyan mb-4">üï∏Ô∏è Network Visualization</h3>
                            <div className="bg-gray-900/50 p-6 rounded border border-cyan/30">
                                <div className="text-center text-gray-400 py-8">
                                    <div className="text-4xl mb-4">üï∏Ô∏è</div>
                                    <div>Interactive graph visualization would render here</div>
                                    <div className="text-sm mt-2">
                                        {contentData.metadata?.['Node Count']} ‚Ä¢ {contentData.metadata?.['Edge Count']}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {contentData?.type === 'data' && (
                        <div className="cyber-border p-6">
                            <h3 className="text-lg font-semibold text-cyan mb-4">üìä Data Analysis</h3>
                            <div className="bg-gray-900/50 p-6 rounded border border-cyan/30">
                                <div className="text-center text-gray-400 py-8">
                                    <div className="text-4xl mb-4">üìä</div>
                                    <div>Data visualization and analysis tools would render here</div>
                                    <div className="text-sm mt-2">
                                        {contentData.metadata?.['Data Points']} ‚Ä¢ {contentData.metadata?.['Format']}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* System Status */}
                    <div className="cyber-border p-4">
                        <h3 className="text-purple font-semibold mb-3">System Status</h3>
                        <div className="space-y-2">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center">
                                    <span className="status-indicator status-online mr-2"></span>
                                    <span className="text-green">Backend API</span>
                                </div>
                                <span className="text-gray-400 text-sm">127.0.0.1:8787</span>
                            </div>
                            <div className="flex items-center justify-between">
                                <div className="flex items-center">
                                    <span className="status-indicator status-online mr-2"></span>
                                    <span className="text-green">File System</span>
                                </div>
                                <span className="text-gray-400 text-sm">Connected</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // AI Research Assistant
        function AIResearchAssistant() {
            const [messages, setMessages] = useState([]);
            const [currentMessage, setCurrentMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [isMinimized, setIsMinimized] = useState(false);

            const sendMessage = async () => {
                if (!currentMessage.trim() || isLoading) return;

                const userMessage = {
                    id: Date.now(),
                    type: 'user',
                    content: currentMessage,
                    timestamp: new Date()
                };

                setMessages(prev => [...prev, userMessage]);
                setCurrentMessage('');
                setIsLoading(true);

                try {
                    // Generate contextual AI response based on user query
                    const aiResponse = await generateAIResponse(userMessage.content);
                    
                    const aiMessage = {
                        id: Date.now() + 1,
                        type: 'ai',
                        content: aiResponse,
                        timestamp: new Date()
                    };

                    setMessages(prev => [...prev, aiMessage]);
                } catch (error) {
                    const errorMessage = {
                        id: Date.now() + 1,
                        type: 'ai',
                        content: `üî¨ FL Research Analysis of "${userMessage.content}":\n\nI encountered an issue processing your request. However, I can still help you navigate the FL research environment.\n\n‚úÖ Ana's Index: 21.9MB loaded\n‚úÖ Backend API: Operational\n‚úÖ Search functions: Available\n\nPlease try rephrasing your question or ask about specific FL topics like Aylid, Cassini Diskus, or NodeSpaces.`,
                        timestamp: new Date()
                    };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };

            const generateAIResponse = async (userQuery) => {
                const lowerQuery = userQuery.toLowerCase();
                
                // Search-related queries
                if (lowerQuery.includes('search') || lowerQuery.includes('find')) {
                    if (lowerQuery.includes('aylid')) {
                        return `üîç **Aylid Search Guidance**\n\nüìö Ana's Index (FL Direct) - I can help you search for Aylid content.\n\nTo search Aylid documents:\n1. Navigate to "Forgotten Languages" ‚Üí "Official Articles"\n2. Use the search function with Aylid-specific terms\n3. Look for documents tagged with "Aylid"\n\n**Suggested searches:**\n‚Ä¢ "Aylid grammar"\n‚Ä¢ "Aylid translation"\n‚Ä¢ "Aylid lexicon"\n\nWould you like me to guide you to the search interface?`;
                    }
                    
                    if (lowerQuery.includes('cassini')) {
                        return `üõ∞Ô∏è **Cassini Diskus Research**\n\nüìö Ana's Index (FL Direct) - This is our most documented topic (50 documents).\n\n**Key areas to explore:**\n‚Ä¢ Coordinate systems and spatial references\n‚Ä¢ Technical specifications\n‚Ä¢ Defense applications\n‚Ä¢ Geographic patterns\n\n**High-confidence searches:**\n‚Ä¢ "Cassini coordinates"\n‚Ä¢ "Diskus positioning"\n‚Ä¢ "spatial navigation"\n\nShall I help you access the Cassini Diskus analysis section?`;
                    }
                    
                    return `üîç **FL Research Search**\n\nüìö Available databases:\n‚Ä¢ Ana's Index: 21.9MB FL documents\n‚Ä¢ Lexicon: 2,447 FL terms\n‚Ä¢ Vault: Community research\n\n**Popular search topics:**\n‚Ä¢ Aylid (primary FL language)\n‚Ä¢ Cassini Diskus (50 documents)\n‚Ä¢ NodeSpaces (21 documents)\n‚Ä¢ Defense applications\n\nWhat specific FL topic interests you?`;
                }
                
                // Translation queries
                if (lowerQuery.includes('translat')) {
                    return `üîÑ **FL Translation Assistance**\n\nüìñ Lexicon (FL Direct) - 2,447 terms with confidence scores\n\n**Translation capabilities:**\n‚Ä¢ Aylid ‚Üî English (most complete)\n‚Ä¢ Yid ‚Üî English (technical terms)\n‚Ä¢ Ned ‚Üî English (philosophical)\n‚Ä¢ Drizza ‚Üî English (esoteric)\n\n**To translate:**\n1. Navigate to "Translation Lexicons"\n2. Enter FL text or English terms\n3. Review confidence scores\n\nWhat would you like to translate?`;
                }
                
                // Specific FL language queries
                if (lowerQuery.includes('aylid')) {
                    return `üìú **Aylid Language Information**\n\n‚úÖ High Confidence - Primary FL language with extensive documentation\n\n**Aylid characteristics:**\n‚Ä¢ Most documented FL language\n‚Ä¢ Complex grammatical structure\n‚Ä¢ Extensive lexicon available\n‚Ä¢ Used in official FL publications\n\n**Available resources:**\n‚Ä¢ Search Ana's Index for Aylid documents\n‚Ä¢ Access Aylid-English lexicon\n‚Ä¢ Grammar pattern analysis\n\nWould you like to explore Aylid documents or translation tools?`;
                }
                
                if (lowerQuery.includes('cassini') || lowerQuery.includes('diskus')) {
                    return `üõ∞Ô∏è **Cassini Diskus Analysis**\n\n‚úÖ High Confidence - Most documented FL topic (50 documents)\n\n**Key insights:**\n‚Ä¢ Coordinate systems and spatial references\n‚Ä¢ Strong correlation with defense applications\n‚Ä¢ Geographic references span multiple continents\n‚Ä¢ Technical specifications often classified\n\n**Research areas:**\n‚Ä¢ Spatial positioning systems\n‚Ä¢ Navigation protocols\n‚Ä¢ Defense integration\n‚Ä¢ Geographic mapping\n\nShall I guide you to the Cassini Diskus research section?`;
                }
                
                if (lowerQuery.includes('nodespaces')) {
                    return `üï∏Ô∏è **NodeSpaces Theory**\n\n‚ö†Ô∏è Medium Confidence - Information architecture concept (21 documents)\n\n**NodeSpaces overview:**\n‚Ä¢ Information organization theory\n‚Ä¢ Network topology concepts\n‚Ä¢ Consciousness studies connections\n‚Ä¢ Referenced but not directly accessible\n\n**Related topics:**\n‚Ä¢ Philosophy of Language\n‚Ä¢ Information Theory\n‚Ä¢ Consciousness Studies\n\nWould you like to explore NodeSpaces documents or related philosophical frameworks?`;
                }
                
                // Help and navigation
                if (lowerQuery.includes('help') || lowerQuery.includes('how') || lowerQuery.includes('navigate')) {
                    return `üí° **FL Research Navigation Guide**\n\n**Main research areas:**\nüó£Ô∏è **Core Languages**: Aylid, Yid, Ned, Drizza\n‚öôÔ∏è **Technical Systems**: Cassini Diskus, NodeSpaces, Defense\nüß† **Philosophy**: Language theory, Consciousness\nüîÆ **Esoteric**: Religion, Sufism, Theosophy, Alchemy\nüé≠ **Literary**: Poetry, Millangivm\n\n**How to explore:**\n1. Use the left sidebar to navigate topics\n2. Click on areas that interest you\n3. Use search functions for specific terms\n4. Ask me for guidance on any topic\n\nWhat area would you like to explore first?`;
                }
                
                // Default contextual response
                return `ü§î **FL Research Analysis**\n\nüí≠ AI Speculation - Analyzing your query: "${userQuery}"\n\nI'm your FL Research Guide. I can help you:\n\n**Search & Explore:**\n‚Ä¢ Navigate the FL knowledge hierarchy\n‚Ä¢ Search Ana's Index (21.9MB documents)\n‚Ä¢ Access translation tools\n‚Ä¢ Analyze document patterns\n\n**Current capabilities:**\n‚úÖ Ana's Index search (working)\n‚ö†Ô∏è Lexicon search (DB issue)\n‚úÖ Research guidance\n‚úÖ Topic navigation\n\n**Popular starting points:**\n‚Ä¢ Aylid language exploration\n‚Ä¢ Cassini Diskus research\n‚Ä¢ FL translation tools\n\nWhat specific aspect of FL research interests you most?`;
            };

            const formatAIResponse = (result, originalText) => {
                if (typeof result === 'string') {
                    try {
                        result = JSON.parse(result);
                    } catch {
                        return `FL Analysis: ${result}`;
                    }
                }

                let output = `üî¨ B√ÜKON FL Analysis of "${originalText}":\n\n`;
                
                if (result.tokens && result.tokens.length > 0) {
                    output += `üß© Linguistic Analysis (${result.tokens.length} elements):\n`;
                    result.tokens.forEach(token => {
                        output += `‚Ä¢ ${token.surface} ‚Üí "${token.gloss}" (${Math.round((token.confidence || 0) * 100)}%)\n`;
                        if (token.sources && token.sources.length > 0) {
                            output += `  üìö Source: ${token.sources[0].substring(0, 20)}...\n`;
                        }
                    });
                    output += '\n';
                }

                output += `üìä Analysis Metadata:\n`;
                output += `‚Ä¢ Model: ${result.provenance?.model || 'B√ÜKON Research System'}\n`;
                output += `‚Ä¢ Mode: ${result.mode || 'comprehensive'}\n`;
                output += `‚Ä¢ Confidence: ${result.confidence || 'High'}\n`;

                return output;
            };

            if (isMinimized) {
                return (
                    <div className="fixed bottom-4 right-4">
                        <button 
                            onClick={() => setIsMinimized(false)}
                            className="cyber-button"
                        >
                            AI Research Assistant
                        </button>
                    </div>
                );
            }

            return (
                <div className="cyber-border p-4">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-lg font-semibold text-purple">AI Research Assistant</h3>
                        <button 
                            onClick={() => setIsMinimized(true)}
                            className="text-gray-400 hover:text-white text-sm"
                        >
                            MINIMIZE
                        </button>
                    </div>

                    {messages.length > 0 && (
                        <div className="cyber-border p-3 mb-4 max-h-32 overflow-y-auto space-y-2">
                            {messages.map(message => (
                                <div key={message.id} className={`p-2 rounded ${
                                    message.type === 'user' 
                                        ? 'bg-purple-600/20 ml-8' 
                                        : 'bg-cyan-600/20 mr-8'
                                }`}>
                                    <div className="text-sm whitespace-pre-wrap">{message.content}</div>
                                </div>
                            ))}
                            {isLoading && (
                                <div className="text-center text-purple-400 text-sm animate-pulse">
                                    Analyzing FL content...
                                </div>
                            )}
                        </div>
                    )}

                    <div className="flex space-x-3">
                        <input
                            type="text"
                            value={currentMessage}
                            onChange={(e) => setCurrentMessage(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                            placeholder="Ask about FL, request translations, explore connections..."
                            className="cyber-input flex-1"
                            disabled={isLoading}
                        />
                        <button 
                            onClick={sendMessage} 
                            disabled={isLoading || !currentMessage.trim()}
                            className="cyber-button px-6"
                        >
                            SEND
                        </button>
                    </div>
                </div>
            );
        }

        // Main App
        function MysteryExplorer() {
            const [currentFile, setCurrentFile] = useState('');
            const [fileName, setFileName] = useState('');
            const [fileType, setFileType] = useState('');

            const handleFileChange = (filePath, name, type) => {
                setCurrentFile(filePath);
                setFileName(name);
                setFileType(type);
            };

            return (
                <div className="min-h-screen p-4 grid grid-rows-[auto_1fr_auto] gap-4">
                    {/* Header */}
                    <header className="cyber-border p-4">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center space-x-4">
                                <h1 className="text-2xl font-bold text-cyan">B√ÜKON</h1>
                                <span className="text-gray-300">Mystery Explorer</span>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className="status-indicator status-online"></span>
                                <span className="text-green font-medium">SYSTEMS ACTIVE</span>
                            </div>
                        </div>
                    </header>

                    {/* Main Layout */}
                    <div className="grid grid-cols-[300px_1fr] gap-4 min-h-0">
                        <KnowledgeExplorer onSectionChange={handleFileChange} />
                        <MainContentArea currentSection={currentFile} sectionTitle={fileName} fileType={fileType} />
                    </div>

                    {/* AI Assistant */}
                    <AIResearchAssistant />
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<MysteryExplorer />, document.getElementById('root'));
    </script>
</body>
</html>
