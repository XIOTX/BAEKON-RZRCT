<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√ÜKON RZRCT - Live FL Analysis</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .cyber-button {
            @apply bg-purple-600/30 hover:bg-purple-500/50 border border-purple-400 px-4 py-2 rounded font-display text-purple-100 transition-all duration-200;
        }
        .cyber-input {
            @apply bg-black/50 border border-gray-600 rounded px-3 py-2 text-white placeholder-gray-400 focus:border-purple-400 focus:outline-none;
        }
        .cyber-border {
            @apply border border-gray-600 rounded-lg bg-black/20 backdrop-blur-sm;
        }
        .font-display {
            font-family: 'Monaco', 'Courier New', monospace;
        }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: white;
            font-family: 'Monaco', 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        function LiveBaekonDemo() {
            const [chatMessages, setChatMessages] = useState([]);
            const [currentMessage, setCurrentMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const chatInputRef = useRef(null);

            const sendMessage = async () => {
                if (!currentMessage.trim()) return;

                const userMessage = {
                    id: Date.now().toString(),
                    type: 'user',
                    content: currentMessage,
                    timestamp: new Date()
                };

                setChatMessages(prev => [...prev, userMessage]);
                setCurrentMessage('');
                setIsLoading(true);

                try {
                    const response = await fetch('http://127.0.0.1:8787/translate/research', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            span_id: '07f94cc1-f652-40d0-95ec-f86ad20228a7',
                            model: 'claude-3-5-sonnet-20241022'
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }

                    const analysisResult = await response.json();
                    
                    let aiResponse = `üî¨ B√ÜKON FL Analysis of "${userMessage.content}":

üéØ Analysis Mode: ${analysisResult.mode}
üìä Tokens Identified: ${analysisResult.tokens?.length || 0}
üîó Model: ${analysisResult.provenance?.model}`;

                    if (analysisResult.tokens && analysisResult.tokens.length > 0) {
                        aiResponse += `\n\nüß© Token Analysis:`;
                        analysisResult.tokens.forEach((token) => {
                            aiResponse += `\n‚Ä¢ ${token.surface} ‚Üí "${token.gloss}" (${Math.round(token.confidence * 100)}% confidence)`;
                            aiResponse += `\n  üìö Source: ${token.sources?.join(', ') || 'unknown'}`;
                            aiResponse += `\n  üîç Method: ${token.method}`;
                        });
                    }

                    if (analysisResult.unresolved && analysisResult.unresolved.length > 0) {
                        aiResponse += `\n\n‚ùì Unresolved tokens: ${analysisResult.unresolved.join(', ')}`;
                    }

                    aiResponse += `\n\nüìù Notes: ${analysisResult.notes}`;

                    const aiMessage = {
                        id: (Date.now() + 1).toString(),
                        type: 'ai',
                        content: aiResponse,
                        timestamp: new Date()
                    };

                    setChatMessages(prev => [...prev, aiMessage]);
                } catch (error) {
                    console.error('API Error:', error);
                    
                    const errorMessage = {
                        id: (Date.now() + 1).toString(),
                        type: 'ai',
                        content: `‚ö†Ô∏è Live API Error: ${error.message}

üîß Troubleshooting:
‚Ä¢ Ensure backend API is running: npm run server
‚Ä¢ Check that port 8787 is accessible
‚Ä¢ Verify Docker services are running

üí° Backend Status: The API should be running at http://127.0.0.1:8787`,
                        timestamp: new Date()
                    };
                    setChatMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-6">
                    <div className="max-w-6xl mx-auto">
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-purple-100 mb-2">
                                B√ÜKON RZRCT
                            </h1>
                            <p className="text-purple-300 font-display">
                                Live FL Research Console ‚Ä¢ Zero-Hallucination Analysis
                            </p>
                            <div className="text-sm text-green-400 mt-2">
                                üü¢ Connected to Live API at http://127.0.0.1:8787
                            </div>
                        </div>

                        <div className="cyber-border p-6 mb-6 h-96 overflow-y-auto">
                            <div className="space-y-4">
                                {chatMessages.length === 0 && (
                                    <div className="text-center text-gray-400 py-8">
                                        <p className="mb-2">üî¨ Ready for FL Analysis</p>
                                        <p className="text-sm">Enter FL text below to get real-time analysis with source attribution</p>
                                    </div>
                                )}
                                
                                {chatMessages.map((message) => (
                                    <div key={message.id} className={`flex ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-3xl p-4 rounded-lg ${
                                            message.type === 'user' 
                                                ? 'bg-blue-600/30 border border-blue-400/50' 
                                                : 'bg-purple-600/20 border border-purple-400/50'
                                        }`}>
                                            <div className="text-sm font-display whitespace-pre-wrap">
                                                {message.content}
                                            </div>
                                            <div className="text-xs text-gray-400 mt-2">
                                                {message.timestamp.toLocaleTimeString()}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                
                                {isLoading && (
                                    <div className="flex justify-start">
                                        <div className="bg-purple-500/20 border border-purple-400/50 p-4 rounded-lg">
                                            <div className="text-sm font-display text-purple-100">
                                                üî¨ Analyzing FL text with live API...
                                                <span className="animate-pulse">‚óè‚óè‚óè</span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="cyber-border p-4">
                            <div className="flex space-x-4">
                                <input
                                    ref={chatInputRef}
                                    type="text"
                                    value={currentMessage}
                                    onChange={(e) => setCurrentMessage(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    placeholder="Enter FL text for live analysis... (e.g., aeshafaf ararth)"
                                    className="cyber-input flex-1 font-display"
                                    disabled={isLoading}
                                />
                                <button
                                    onClick={sendMessage}
                                    disabled={isLoading || !currentMessage.trim()}
                                    className="cyber-button px-6"
                                >
                                    {isLoading ? 'ANALYZING...' : 'ANALYZE'}
                                </button>
                            </div>
                        </div>

                        <div className="text-center mt-6 text-sm text-gray-400">
                            <p>üí° Try: "aeshafaf ararth nebeder" or any FL text</p>
                            <p className="mt-2">Powered by Claude API ‚Ä¢ Live lexicon lookup ‚Ä¢ Real-time analysis</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<LiveBaekonDemo />, document.getElementById('root'));
    </script>
</body>
</html>
